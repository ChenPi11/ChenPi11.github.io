"use strict";import{getPreferredTermTheme}from"./term-themes.js";class TerminalApplet extends HTMLElement{static observedAttributes=["title","columns","rows","src"];constructor(){super()}connectedCallback(){const $this=$(this);this.title=$this.attr("title")||"未命名终端";this.src=$this.attr("src");if(!this.src){console.error("Terminal applet's src is not defined.")}$this.addClass("terminal-applet");this.header=$(`<div class="terminal-applet-header"></div>`);$this.append(this.header);this.button=$(`<button class="terminal-applet-toggle-button" type="button">-</button>`);this.header.append(this.button);this.titleElement=$(`<div class="terminal-applet-title"></div>`);this.titleElement.text(this.title);this.header.append(this.titleElement);this.terminalElement=$(`<div class="terminal-applet-terminal"></div>`);$this.append(this.terminalElement);this.columns=this.getAttribute("columns")||"80";this.rows=this.getAttribute("rows")||"25";this.columns=parseInt(this.columns);this.rows=parseInt(this.rows);this.terminal=new Terminal({theme:getPreferredTermTheme(),fontFamily:"Meslo, monospace",fontSize:14,scrollback:9999999});this.loadAddons();this.terminal.open(this.terminalElement.get(0));this.terminal.resize(this.columns,this.rows);this.postLoadAddons();this.collapsed=false;const self=this;function toggleContent(){const terminalElement=self.terminalElement;const button=self.button;if(self.collapsed){terminalElement.css("maxHeight",`${terminalElement.prop("scrollHeight")}px`);button.text("-");self.collapsed=false}else{terminalElement.css("maxHeight","0px");button.text("+");self.collapsed=true}}this.header.on("click",toggleContent);$((function(){const terminalElement=self.terminalElement;terminalElement.css("maxHeight",`${terminalElement.prop("scrollHeight")}px`)}));this.executeApplet()}loadAddons(){}postLoadAddons(){}executeApplet(){const $this=$(this);this.applet_element=$(`<script src="${this.src}"><\/script>`);$this.append(this.applet_element)}}customElements.define("terminal-applet",TerminalApplet);
